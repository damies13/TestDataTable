---
name: Regression Tests

on: push

jobs:
  Agent:
    strategy:
      matrix:
        platform: [ubuntu-latest, macos-latest, windows-latest]
        # python: ['3.7', '3.8', '3.9', '3.10', '3.11', '3.12']
        python: ['3.7']
      fail-fast: false
    runs-on: ${{ matrix.platform }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python }}

      - name: Install Pip Requirements
      - run: pip install -r Regression_Tests/pip_requirements.txt

      - name: Run TestDataTable
      - run: python3 testdatatable/TestDataTable.py  -p 1080

      - name: Robot Framework
        run: >
          robot --include ${{ matrix.platform }}
          --outputdir Regression_Tests/Logs/${{ matrix.platform }}_${{ matrix.python }}
          Regression_Tests

      - name: Archive Agent Logs
        if: ${{ success() }}
        uses: actions/upload-artifact@v4
        with:
          name: Regression_Tests-${{ matrix.platform }}-${{ matrix.python }}
          path: Regression_Tests/Logs/${{ matrix.platform }}_${{ matrix.python }}
          retention-days: 15

      - name: Archive Agent Logs (longer retention if failed)
        if: ${{ failure() }}
        uses: actions/upload-artifact@v4
        with:
          name: Regression_Tests-${{ matrix.platform }}-${{ matrix.python }}
          path: Regression_Tests/Logs/${{ matrix.platform }}_${{ matrix.python }}
          retention-days: 90
